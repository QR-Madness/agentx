# ============================================================================
# AgentX Taskfile
# ============================================================================
# A comprehensive task runner for the AgentX AI Agent Platform.
#
# Usage:
#   task              - Show available tasks
#   task dev          - Start full development environment
#   task --list-all   - List all tasks including internal ones
#
# Groups:
#   dev:*      - Development workflow commands
#   api:*      - Django API server commands
#   client:*   - Tauri/React client commands
#   db:*       - Database management (Docker services)
#   mcp:*      - MCP server inspection tools
#   docs:*     - Documentation commands
#   clean:*    - Cleanup and reset commands
# ============================================================================

version: '3'

vars:
  # Platform detection
  OS: '{{if eq OS "windows"}}windows{{else if eq OS "darwin"}}macos{{else}}linux{{end}}'
  
  # App data paths by platform
  APP_DATA_LINUX: "~/.local/share/agentx"
  APP_DATA_MACOS: "~/Library/Application Support/agentx"
  APP_DATA_WINDOWS: "%APPDATA%\\agentx"
  
  # Tauri app identifier (used for locating app data)
  TAURI_BUNDLE_ID: "com.agentx.app"

# ============================================================================
# DEFAULT & SETUP
# ============================================================================

tasks:
  default:
    desc: "Show available tasks"
    silent: true
    cmds:
      - task --list

  setup:
    desc: "First-time setup: install deps, init databases, verify environment"
    cmds:
      - task: install
      - task: db:init
      - task: check
    
  check:
    desc: "Verify development environment is ready"
    silent: true
    cmds:
      - echo "üîç Checking development environment..."
      - |
        MISSING=""
        WARNINGS=""

        # Check data directories
        [ ! -d "data/postgres" ] && MISSING="${MISSING}\n  ‚úó data/postgres/ (run: task db:init)"
        [ ! -d "data/neo4j" ] && MISSING="${MISSING}\n  ‚úó data/neo4j/ (run: task db:init)"
        [ ! -d "data/redis" ] && MISSING="${MISSING}\n  ‚úó data/redis/ (run: task db:init)"

        # Check dependencies
        [ ! -d ".venv" ] && MISSING="${MISSING}\n  ‚úó .venv/ (run: task install)"
        [ ! -d "client/node_modules" ] && MISSING="${MISSING}\n  ‚úó client/node_modules/ (run: task install)"

        # Check optional files
        [ ! -f ".env" ] && WARNINGS="${WARNINGS}\n  ‚ö† .env not found (copy from .env.example)"
        [ ! -f "mcp_servers.json" ] && WARNINGS="${WARNINGS}\n  ‚ö† mcp_servers.json not found (copy from mcp_servers.json.example)"

        # Report
        if [ -n "$MISSING" ]; then
          echo -e "‚ùå Missing required components:$MISSING"
          echo ""
          echo "Run 'task setup' to initialize everything."
          exit 1
        fi

        if [ -n "$WARNINGS" ]; then
          echo -e "‚ö†Ô∏è  Optional configs missing:$WARNINGS"
          echo ""
        fi

        echo "‚úÖ Development environment is ready!"

# ============================================================================
# DEVELOPMENT WORKFLOW
# ============================================================================

  dev:
    desc: "Start full dev environment (Docker + API + Client)"
    deps: [check, db:up]
    cmds:
      - defer: { task: db:down }
      - bunx concurrently -n "API,CLIENT" -c "blue.bold,magenta.bold" 
          "cd api && uv run python manage.py runserver 127.0.0.1:12319" 
          "cd client && bun run tauri dev"

  dev:api:
    desc: "Start only the API server (assumes Docker running)"
    dir: api
    cmds:
      - uv run python manage.py runserver 127.0.0.1:12319

  dev:client:
    desc: "Start only the Tauri client (assumes API running)"
    dir: client
    cmds:
      - bun run tauri dev

  dev:web:
    desc: "Start client in browser mode (no Tauri, port 1420)"
    dir: client
    cmds:
      - bun run dev

# ============================================================================
# INSTALLATION
# ============================================================================

  install:
    desc: "Install all dependencies (API + Client)"
    cmds:
      - echo "üì¶ Installing dependencies..."
      - bun install -g concurrently
      - task: install:api
      - task: install:client
      - echo "‚úÖ All dependencies installed!"

  install:api:
    desc: "Install Python dependencies via uv"
    cmds:
      - uv sync

  install:client:
    desc: "Install Node dependencies via bun"
    dir: client
    cmds:
      - bun install

# ============================================================================
# API SERVER
# ============================================================================

  api:run:
    desc: "Run Django development server"
    aliases: [api:runserver]
    dir: api
    cmds:
      - uv run python manage.py runserver 127.0.0.1:12319

  api:shell:
    desc: "Open Django interactive shell"
    dir: api
    cmds:
      - uv run python manage.py shell

  api:migrate:
    desc: "Apply database migrations"
    dir: api
    cmds:
      - uv run python manage.py migrate

  api:makemigrations:
    desc: "Create new migrations from model changes"
    dir: api
    cmds:
      - uv run python manage.py makemigrations

# ============================================================================
# CLIENT
# ============================================================================

  client:dev:
    desc: "Run Tauri app in development mode"
    dir: client
    cmds:
      - bun run tauri dev

  client:build:
    desc: "Build Tauri app for production"
    dir: client
    cmds:
      - bun run tauri build

  client:preview:
    desc: "Preview production web build (no Tauri)"
    deps: [client:build:web]
    dir: client
    cmds:
      - bun run preview

  client:build:web:
    desc: "Build web assets only (no Tauri packaging)"
    dir: client
    cmds:
      - bun run build

# ============================================================================
# TESTING
# ============================================================================

  test:
    desc: "Run all backend tests"
    env:
      DJANGO_SETTINGS_MODULE: agentx_api.settings
    cmds:
      - uv run python api/manage.py test agentx_ai.tests -v2

  test:quick:
    desc: "Run tests without model loading (faster)"
    env:
      DJANGO_SETTINGS_MODULE: agentx_api.settings
    cmds:
      - uv run python api/manage.py test agentx_ai.tests.HealthCheckTest agentx_ai.tests.MCPClientTest agentx_ai.tests.MCPServerRegistryTest -v2

# ============================================================================
# DATABASE SERVICES (Docker)
# ============================================================================

  db:up:
    desc: "Start database services (Neo4j, PostgreSQL, Redis)"
    aliases: [runners]
    deps: [check]
    cmds:
      - docker-compose up -d

  db:down:
    desc: "Stop database services"
    aliases: [teardown]
    cmds:
      - docker-compose down

  db:restart:
    desc: "Restart database services"
    cmds:
      - docker-compose restart

  db:logs:
    desc: "Tail logs from all database containers"
    cmds:
      - docker-compose logs -f

  db:init:
    desc: "Initialize local data directories for databases"
    cmds:
      - echo "üìÅ Creating data directories..."
      - mkdir -p data/neo4j/{data,logs,plugins}
      - mkdir -p data/postgres
      - mkdir -p data/redis
      - mkdir -p backups
      - echo "‚úÖ Data directories ready in ./data/"

  db:init:schemas:
    desc: "Initialize database schemas (Neo4j, PostgreSQL, Redis)"
    deps: [db:up]
    env:
      DJANGO_SETTINGS_MODULE: agentx_api.settings
    cmds:
      - echo "üóÑÔ∏è Initializing memory system schemas..."
      - echo "   (Waiting for databases to be ready...)"
      - sleep 5
      - uv run python api/manage.py init_memory_schema --verbose
      - echo ""
      - echo "‚úÖ Schema initialization complete!"

  db:verify:schemas:
    desc: "Verify database schemas exist (no changes)"
    deps: [db:up]
    env:
      DJANGO_SETTINGS_MODULE: agentx_api.settings
    cmds:
      - uv run python api/manage.py init_memory_schema --verify

  memory:worker:
    desc: "Start background memory consolidation worker"
    deps: [db:up]
    env:
      DJANGO_SETTINGS_MODULE: agentx_api.settings
    cmds:
      - uv run python -m agentx_ai.kit.agent_memory.consolidation.worker

  db:status:
    desc: "Show status of database containers"
    cmds:
      - docker-compose ps

  db:clean:
    desc: "‚ö†Ô∏è  Remove ALL database data (destructive!)"
    prompt: "This will DELETE all database data. Are you sure?"
    cmds:
      - rm -rf data/neo4j/data/*
      - rm -rf data/neo4j/logs/*
      - rm -rf data/neo4j/plugins/*
      - rm -rf data/postgres/*
      - rm -rf data/redis/*
      - echo "‚úÖ Database data cleared"

  db:shell:postgres:
    desc: "Open PostgreSQL shell (psql)"
    cmds:
      - docker exec -it agent-postgres psql -U agent -d agent_memory

  db:shell:redis:
    desc: "Open Redis CLI"
    cmds:
      - docker exec -it agent-redis redis-cli

  db:shell:neo4j:
    desc: "Open Neo4j Cypher shell"
    cmds:
      - docker exec -it agent-neo4j cypher-shell -u neo4j -p "${NEO4J_PASSWORD:-agent_memory}"

  db:backup:
    desc: "Backup PostgreSQL database"
    cmds:
      - echo "üíæ Creating backup..."
      - mkdir -p backups
      - docker exec agent-postgres pg_dump -U agent agent_memory > "backups/postgres_$(date +%Y%m%d_%H%M%S).sql"
      - echo "‚úÖ Backup saved to ./backups/"

  db:restore:
    desc: "Restore PostgreSQL from backup (BACKUP_FILE=path/to/file.sql)"
    requires:
      vars: [BACKUP_FILE]
    cmds:
      - echo "üì• Restoring from {{.BACKUP_FILE}}..."
      - docker exec -i agent-postgres psql -U agent -d agent_memory < "{{.BACKUP_FILE}}"
      - echo "‚úÖ Restore complete!"

  db:migrate-volumes:
    desc: "Migrate data from Docker volumes to local ./data/"
    cmds:
      - task: db:migrate-volumes:neo4j
      - task: db:migrate-volumes:postgres
      - task: db:migrate-volumes:redis

  db:migrate-volumes:neo4j:
    desc: "Migrate Neo4j volumes to local"
    internal: true
    cmds:
      - mkdir -p data/neo4j/{data,logs,plugins}
      - docker run --rm -v agentx-source_neo4j_data:/from -v "{{.ROOT_DIR}}/data/neo4j/data:/to" alpine sh -c "cp -av /from/. /to/"
      - docker run --rm -v agentx-source_neo4j_logs:/from -v "{{.ROOT_DIR}}/data/neo4j/logs:/to" alpine sh -c "cp -av /from/. /to/"
      - docker run --rm -v agentx-source_neo4j_plugins:/from -v "{{.ROOT_DIR}}/data/neo4j/plugins:/to" alpine sh -c "cp -av /from/. /to/"
    status:
      - test -d data/neo4j/data/databases

  db:migrate-volumes:postgres:
    desc: "Migrate PostgreSQL volumes to local"
    internal: true
    cmds:
      - mkdir -p data/postgres
      - docker run --rm -v agentx-source_postgres_data:/from -v "{{.ROOT_DIR}}/data/postgres:/to" alpine sh -c "cp -av /from/. /to/"
    status:
      - test -f data/postgres/PG_VERSION

  db:migrate-volumes:redis:
    desc: "Migrate Redis volumes to local"
    internal: true
    cmds:
      - mkdir -p data/redis
      - docker run --rm -v agentx-source_redis_data:/from -v "{{.ROOT_DIR}}/data/redis:/to" alpine sh -c "cp -av /from/. /to/"
    status:
      - test -f data/redis/appendonlydir/appendonly.aof.1.base.rdb || test -f data/redis/appendonly.aof

# ============================================================================
# MCP TOOLS
# ============================================================================

  mcp:servers:
    desc: "List configured MCP servers"
    aliases: [mcp:list-servers]
    cmds:
      - curl -s http://127.0.0.1:12319/api/mcp/servers | python -m json.tool

  mcp:tools:
    desc: "List available MCP tools (requires API running)"
    aliases: [mcp:list-tools]
    cmds:
      - curl -s http://127.0.0.1:12319/api/mcp/tools | python -m json.tool

  mcp:resources:
    desc: "List available MCP resources (requires API running)"
    cmds:
      - curl -s http://127.0.0.1:12319/api/mcp/resources | python -m json.tool

  mcp:health:
    desc: "Check API health including memory systems"
    cmds:
      - curl -s "http://127.0.0.1:12319/api/health?include_memory=true" | python -m json.tool

# ============================================================================
# DOCUMENTATION
# ============================================================================

  docs:serve:
    desc: "Serve docs locally with live reload (port 8000)"
    cmds:
      - uv run mkdocs serve

  docs:build:
    desc: "Build static documentation site"
    cmds:
      - uv run mkdocs build

  docs:deploy:
    desc: "Deploy docs to GitHub Pages"
    cmds:
      - uv run mkdocs gh-deploy --force

# ============================================================================
# CLEANUP & RESET
# ============================================================================

  clean:
    desc: "Remove build artifacts and caches"
    cmds:
      - echo "üßπ Cleaning build artifacts..."
      - rm -rf site/
      - rm -rf client/dist/
      - rm -rf client/src-tauri/target/
      - rm -rf api/__pycache__/
      - rm -rf .pytest_cache/
      - find . -type d -name "__pycache__" -exec rm -rf {} + 2>/dev/null || true
      - find . -type f -name "*.pyc" -delete 2>/dev/null || true
      - echo "‚úÖ Clean complete!"

  clean:all:
    desc: "‚ö†Ô∏è  Full reset: artifacts + node_modules + venv"
    prompt: "This removes node_modules and .venv. Continue?"
    cmds:
      - task: clean
      - rm -rf client/node_modules/
      - rm -rf .venv/
      - echo "‚úÖ Full clean complete! Run 'task install' to reinstall."

  clean:appdata:
    desc: "‚ö†Ô∏è  Remove AgentX user data (platform-specific)"
    prompt: "This removes your AgentX settings and data. Continue?"
    platforms: [linux, darwin]
    cmds:
      - |
        {{if eq .OS "linux"}}
        echo "üóëÔ∏è  Removing Linux app data..."
        rm -rf ~/.local/share/agentx/
        rm -rf ~/.local/share/com.agentx.app/
        rm -rf ~/.config/agentx/
        rm -rf ~/.config/com.agentx.app/
        {{else if eq .OS "macos"}}
        echo "üóëÔ∏è  Removing macOS app data..."
        rm -rf ~/Library/Application\ Support/agentx/
        rm -rf ~/Library/Application\ Support/com.agentx.app/
        rm -rf ~/Library/Preferences/com.agentx.app.plist
        rm -rf ~/Library/Caches/com.agentx.app/
        {{end}}
        echo "‚úÖ App data removed!"

  clean:appdata:windows:
    desc: "‚ö†Ô∏è  Remove AgentX user data (Windows)"
    platforms: [windows]
    cmds:
      - echo "üóëÔ∏è  Removing Windows app data..."
      - cmd /c "rmdir /s /q %APPDATA%\\agentx 2>nul"
      - cmd /c "rmdir /s /q %APPDATA%\\com.agentx.app 2>nul"
      - cmd /c "rmdir /s /q %LOCALAPPDATA%\\agentx 2>nul"
      - cmd /c "rmdir /s /q %LOCALAPPDATA%\\com.agentx.app 2>nul"
      - echo "‚úÖ App data removed!"

  clean:docker:
    desc: "‚ö†Ô∏è  Remove Docker volumes (keeps local ./data/)"
    prompt: "Remove Docker volumes for this project?"
    cmds:
      - docker-compose down -v
      - echo "‚úÖ Docker volumes removed!"
  
  remove:concurrently:
    prompt: "Remove globally installed 'concurrently' package?"
    desc: "Remove globally installed 'concurrently' package"
    cmds:
      - bun uninstall -g concurrently || echo "‚ÑπÔ∏è  'concurrently' not found globally."

  reset:
    desc: "‚ö†Ô∏è  Complete reset: stop services, clean everything"
    prompt: "This performs a FULL reset. All data will be lost. Continue?"
    cmds:
      - task: db:down
      - task: clean:all
      - task: db:clean
      - echo ""
      - echo "üîÑ Reset complete! Run 'task setup' to start fresh."

# ============================================================================
# LINTING & FORMATTING
# ============================================================================

  lint:
    desc: "Run all linters"
    cmds:
      - task: lint:python
      - task: lint:client

  lint:python:
    desc: "Lint Python code with ruff"
    cmds:
      - uv run ruff check api/

  lint:python:fix:
    desc: "Auto-fix Python lint issues"
    cmds:
      - uv run ruff check --fix api/

  lint:client:
    desc: "Lint TypeScript/React code"
    dir: client
    cmds:
      - bun run lint 2>/dev/null || echo "‚ÑπÔ∏è  No lint script configured in client"

  format:
    desc: "Format all code"
    cmds:
      - task: format:python
      - task: format:client

  format:python:
    desc: "Format Python code with ruff"
    cmds:
      - uv run ruff format api/

  format:client:
    desc: "Format TypeScript/React code with prettier"
    dir: client
    cmds:
      - bunx prettier --write "src/**/*.{ts,tsx,css}" 2>/dev/null || echo "‚ÑπÔ∏è  Prettier not configured"

# ============================================================================
# MODEL MANAGEMENT
# ============================================================================

  models:download:
    desc: "Pre-download AI models (translation, embeddings)"
    cmds:
      - echo "üì• Downloading translation models..."
      - uv run python -c "
        from transformers import AutoModelForSeq2SeqLM, AutoTokenizer, pipeline
        print('Downloading NLLB-200 translation model...')
        AutoModelForSeq2SeqLM.from_pretrained('facebook/nllb-200-distilled-600M')
        AutoTokenizer.from_pretrained('facebook/nllb-200-distilled-600M')
        print('Downloading language detection model...')
        pipeline('text-classification', model='eleldar/language-detection')
        print('‚úÖ Models downloaded!')
        "

  models:cache:
    desc: "Show HuggingFace cache location and size"
    cmds:
      - |
        CACHE_DIR="${HF_HOME:-${XDG_CACHE_HOME:-$HOME/.cache}/huggingface}"
        echo "üìÅ HuggingFace cache: $CACHE_DIR"
        if [ -d "$CACHE_DIR" ]; then
          SIZE=$(du -sh "$CACHE_DIR" 2>/dev/null | cut -f1)
          echo "üìä Cache size: $SIZE"
          echo ""
          echo "Models cached:"
          ls -1 "$CACHE_DIR/hub" 2>/dev/null | grep "models--" | sed 's/models--/  - /' | sed 's/--/\//g' || echo "  (none)"
        else
          echo "  (cache directory not found)"
        fi

  models:clear:
    desc: "‚ö†Ô∏è  Clear HuggingFace model cache"
    prompt: "This removes all cached models. They will re-download on next use. Continue?"
    cmds:
      - |
        CACHE_DIR="${HF_HOME:-${XDG_CACHE_HOME:-$HOME/.cache}/huggingface}"
        rm -rf "$CACHE_DIR/hub"
        echo "‚úÖ Model cache cleared!"

# ============================================================================
# LOGS & DEBUGGING
# ============================================================================

  logs:
    desc: "Tail all logs (Docker + API)"
    cmds:
      - bunx concurrently -n "DOCKER,API" -c "gray,cyan" 
          "docker-compose logs -f --tail=50" 
          "tail -f api/*.log 2>/dev/null || echo 'No API logs found'"

  logs:docker:
    desc: "Tail Docker container logs"
    cmds:
      - docker-compose logs -f --tail=100

  logs:api:
    desc: "Tail Django API logs"
    cmds:
      - tail -f api/*.log 2>/dev/null || echo "No log files. Logs go to stdout in dev mode."

  debug:env:
    desc: "Show environment configuration"
    cmds:
      - echo "üîß Environment Configuration"
      - echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
      - echo ""
      - 'echo "Platform: {{.OS}}"'
      - 'echo "Python:   $(python --version 2>&1)"'
      - 'echo "Node:     $(node --version 2>&1)"'
      - 'echo "Bun:      $(bun --version 2>&1)"'
      - 'echo "Docker:   $(docker --version 2>&1)"'
      - 'echo "Task:     $(task --version 2>&1)"'
      - echo ""
      - echo "üìÅ Key Paths:"
      - 'echo "  Project root: $(pwd)"'
      - 'echo "  Python venv:  $(which python)"'
      - 'echo "  uv cache:     ${UV_CACHE_DIR:-~/.cache/uv}"'
      - 'echo "  HF cache:     ${HF_HOME:-~/.cache/huggingface}"'
      - echo ""
      - echo "üîë API Keys Configured:"
      - |
        [ -n "$OPENAI_API_KEY" ] && echo "  ‚úì OPENAI_API_KEY" || echo "  ‚úó OPENAI_API_KEY"
        [ -n "$ANTHROPIC_API_KEY" ] && echo "  ‚úì ANTHROPIC_API_KEY" || echo "  ‚úó ANTHROPIC_API_KEY"
        [ -n "$GITHUB_TOKEN" ] && echo "  ‚úì GITHUB_TOKEN" || echo "  ‚úó GITHUB_TOKEN"

  debug:ports:
    desc: "Check if required ports are available"
    cmds:
      - echo "üîå Port Status"
      - echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
      - |
        check_port() {
          if lsof -i ":$1" >/dev/null 2>&1; then
            PROC=$(lsof -i ":$1" -t 2>/dev/null | head -1)
            NAME=$(ps -p "$PROC" -o comm= 2>/dev/null)
            echo "  $1: IN USE by $NAME (PID $PROC)"
          else
            echo "  $1: available ‚úì"
          fi
        }
        echo "API & Client:"
        check_port 12319
        check_port 1420
        check_port 1421
        echo ""
        echo "Databases:"
        check_port 7687
        check_port 7474
        check_port 5432
        check_port 6379

  debug:api:
    desc: "Test API endpoints"
    cmds:
      - echo "üß™ Testing API Endpoints"
      - echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
      - echo ""
      - echo "GET /api/index"
      - curl -s http://127.0.0.1:12319/api/index | python -m json.tool 2>/dev/null || echo "  ‚ùå Failed (is API running?)"
      - echo ""
      - echo "GET /api/health"
      - curl -s http://127.0.0.1:12319/api/health | python -m json.tool 2>/dev/null || echo "  ‚ùå Failed"
      - echo ""
      - echo "GET /api/providers"
      - curl -s http://127.0.0.1:12319/api/providers | python -m json.tool 2>/dev/null || echo "  ‚ùå Failed"

# ============================================================================
# RELEASE & BUILD
# ============================================================================

  release:build:
    desc: "Build release binaries for current platform"
    cmds:
      - echo "üî® Building release..."
      - task: client:build
      - echo ""
      - echo "‚úÖ Build complete! Binaries in client/src-tauri/target/release/"
      - ls -lh client/src-tauri/target/release/bundle/*/* 2>/dev/null || echo "(check target/release for output)"

  release:build:debug:
    desc: "Build debug binary (faster, larger)"
    dir: client
    cmds:
      - bun run tauri build --debug

  release:check:
    desc: "Verify release readiness"
    cmds:
      - echo "üîç Release Checklist"
      - echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
      - |
        ISSUES=""
        
        # Check for uncommitted changes
        if [ -n "$(git status --porcelain)" ]; then
          ISSUES="${ISSUES}\n  ‚ö†Ô∏è  Uncommitted changes detected"
        else
          echo "  ‚úì Git working tree clean"
        fi
        
        # Check tests pass
        echo "  ‚è≥ Running tests..."
        if uv run python api/manage.py test agentx_ai.tests --verbosity=0 2>/dev/null; then
          echo "  ‚úì Tests passing"
        else
          ISSUES="${ISSUES}\n  ‚ùå Tests failing"
        fi
        
        # Check TypeScript compiles
        echo "  ‚è≥ Checking TypeScript..."
        if (cd client && bun run build 2>/dev/null); then
          echo "  ‚úì TypeScript compiles"
        else
          ISSUES="${ISSUES}\n  ‚ùå TypeScript errors"
        fi
        
        if [ -n "$ISSUES" ]; then
          echo ""
          echo "Issues found:"
          echo -e "$ISSUES"
          exit 1
        else
          echo ""
          echo "‚úÖ Ready for release!"
        fi

# ============================================================================
# QUICK SHORTCUTS
# ============================================================================

  s:
    desc: "Shortcut: task setup"
    cmds:
      - task: setup

  d:
    desc: "Shortcut: task dev"
    cmds:
      - task: dev

  t:
    desc: "Shortcut: task test"
    cmds:
      - task: test

  b:
    desc: "Shortcut: task release:build"
    cmds:
      - task: release:build

  c:
    desc: "Shortcut: task check"
    cmds:
      - task: check
